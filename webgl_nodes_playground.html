@ -1,189 +0,0 @@
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Verge3D webgl - node-editor playground</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="fonts/open-sans/open-sans.css" type="text/css"/>
    <link rel="stylesheet" href="fonts/tabler-icons/tabler-icons.min.css" type="text/css"/>
    <link type="text/css" rel="stylesheet" href="main.css">
    <style>
      body {
        overflow: hidden;
        width: 100%;
        height: 100%;
      }
      .renderer {
        position: absolute;
        top: 0;
        left: 0;
        height: 50%;
        width: 100%;
      }
      flow {
        position: absolute;
        top: 50%;
        left: 0;
        height: 50%;
        width: 100%;
        background: #222;
        box-shadow: inset 0 0 20px 0px #000000;
      }
    </style>
  </head>
  <body>

  <div id="info">
    <a href="https://www.soft8soft.com/verge3d" target="_blank" rel="noopener">Verge3D</a> - WebGL - Node Editor (Playground version)<br />
  </div>

  <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

  <script type="importmap">
  {
    "imports": {
      "v3d": "../build/v3d.module.js"
    }
  }
  </script>

  <script type="module">

    import * as v3d from 'v3d';

    import { nodeFrame } from './jsm/renderers/webgl/nodes/WebGLNodes.js';

    import { NodeEditor } from './jsm/node-editor/NodeEditor.js';
    import { MeshEditor } from './jsm/node-editor/scene/MeshEditor.js';

    import * as Nodes from './jsm/renderers/nodes/Nodes.js';

    import Stats from './jsm/libs/stats.module.js';

    import { OrbitControls } from './jsm/controls/OrbitControls.js';
    import { FBXLoader } from './jsm/loaders/FBXLoader.js';

    let stats;
    let camera, scene, renderer;
    let model;

    init();
    animate();

    function init() {

      camera = new v3d.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 5000);
      camera.position.set(0.0, 300, 400 * 3);

      scene = new v3d.Scene();
      scene.background = new v3d.Color(0x333333);

      // Lights

      const topLight = new v3d.PointLight(0xF4F6F0, 1);
      topLight.position.set(0, 100000, 100000);
      scene.add(topLight);

      const backLight = new v3d.PointLight(0x0c1445, 1.4);
      backLight.position.set(- 100, 20, - 260);
      scene.add(backLight);

      renderer = new v3d.WebGLRenderer({ antialias: true });
      document.body.appendChild(renderer.domElement);
      renderer.outputEncoding = v3d.sRGBEncoding;

      renderer.domElement.className = 'renderer';

      //

      stats = new Stats();
      document.body.appendChild(stats.dom);

      const controls = new OrbitControls(camera, renderer.domElement);
      controls.minDistance = 500;
      controls.maxDistance = 3000;

      window.addEventListener('resize', onWindowResize);

      onWindowResize();

      initEditor();

    }

    function initEditor() {

      const nodeEditor = new NodeEditor(scene);

      nodeEditor.addEventListener('new', () => {

        const materialEditor = new MeshEditor(model);

        nodeEditor.add(materialEditor);
        nodeEditor.centralizeNode(materialEditor);

      });

      document.body.appendChild(nodeEditor.domElement);

      const loaderFBX = new FBXLoader();
      loaderFBX.load('models/fbx/stanford-bunny.fbx', (object) => {

        const defaultMaterial = new Nodes.MeshBasicNodeMaterial();
        defaultMaterial.colorNode = new Nodes.FloatNode(0);

        const sphere = new v3d.Mesh(new v3d.SphereGeometry(200, 32, 16), defaultMaterial) ;
        sphere.name = 'Sphere';
        sphere.position.set(500, 0, -500);
        scene.add(sphere);

        const box = new v3d.Mesh(new v3d.BoxGeometry(200, 200, 200), defaultMaterial) ;
        box.name = 'Box';
        box.position.set(-500, 0, -500);
        scene.add(box);

        const defaultPointsMaterial = new Nodes.PointsNodeMaterial();
        defaultPointsMaterial.colorNode = new Nodes.FloatNode(0);

        const torusKnot = new v3d.Points(new v3d.TorusKnotGeometry(100, 30, 100, 16), defaultPointsMaterial) ;
        torusKnot.name = 'Torus Knot (Points)';
        torusKnot.position.set(0, 0, -500);
        scene.add(torusKnot);

        model = object.children[0];
        model.position.set(0, 0, 10);
        model.scale.setScalar(1);
        model.material = defaultMaterial;
        scene.add(model);

        const materialEditor = new MeshEditor(model);

        nodeEditor.add(materialEditor);
        nodeEditor.centralizeNode(materialEditor);

      });

    }

    function onWindowResize() {

      const width = window.innerWidth;
      const height = window.innerHeight / 2;

      camera.aspect = width / height;
      camera.updateProjectionMatrix();

      renderer.setSize(width, height);

    }

    //

    function animate() {

      requestAnimationFrame(animate);

      nodeFrame.update();

      render();

      stats.update();

    }

    function render() {

      //if (model) model.rotation.y = performance.now() / 5000;

      renderer.render(scene, camera);

    }

  </script>

  </body>
</html>
